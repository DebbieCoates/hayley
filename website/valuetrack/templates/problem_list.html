{% extends 'base.html' %}


{% block content %}
problem_list.html   

    <br/><br/>    
    <h1>Problem List</h1>
    <br/>

    <a href="{% url 'problem_add' %}" class="btn btn-primary btn-sm">Add Problem</a>

    <br/><br/>
    <div class="mb-4 text-end ms-auto">
    <h5>Status Summary</h5>
    <ul class="list-inline">
        {% for item in status_summary %}
        <li class="list-inline-item"><strong>{{ item.status }}:</strong> {{ item.count }}</li>
        {% endfor %}
    </ul>

    <h5>Urgency Summary</h5>
    <ul class="list-inline">
        {% for item in urgency_summary %}
        <li class="list-inline-item"><strong>{{ item.urgency }}:</strong> {{ item.count }}</li>
        {% endfor %}
    </ul>
    </div>

    <form method="get" class="mb-3 d-flex gap-3 align-items-end">
  <div>
    <label for="status">Filter by Status:</label>
    <select name="status" id="status" class="form-select form-select-sm">
      <option value="">All</option>
      <option value="Open" {% if status_filter == 'Open' %}selected{% endif %}>Open</option>
      <option value="Closed" {% if status_filter == 'Closed' %}selected{% endif %}>Closed</option>
      <option value="In Progress" {% if status_filter == 'In Progress' %}selected{% endif %}>In Progress</option>
    </select>
  </div>

  <div>
    <label for="urgency">Filter by Urgency:</label>
    <select name="urgency" id="urgency" class="form-select form-select-sm">
      <option value="">All</option>
      <option value="Low" {% if urgency_filter == 'Low' %}selected{% endif %}>Low</option>
      <option value="Medium" {% if urgency_filter == 'Medium' %}selected{% endif %}>Medium</option>
      <option value="High" {% if urgency_filter == 'High' %}selected{% endif %}>High</option>
    </select>
  </div>

  <div>
    <button type="submit" class="btn btn-secondary btn-sm">Apply Filters</button>
    <a href="{% url 'problems' %}" class="btn btn-outline-secondary btn-sm">Reset</a>
  </div>

    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="direction" value="{{ direction }}">
</form>

    <table class="table table-striped table-hover table-bordered" >
        <thead class="table-light">
            <tr>
                <th><a href="?sort=customer__name&direction={% if sort == 'customer__name' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Customer {% if sort == 'customer__name' %}{% if direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}
                </a></th>

                <th><a href="?sort=title&direction={% if sort == 'title' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Title {% if sort == 'title' %}{% if direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}
                </a></th>


                {% comment %} <th scope="col">Impact</th> {% endcomment %}
                <th><a href="?sort=urgency&direction={% if sort == 'urgency' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Urgency {% if sort == 'urgency' %}{% if direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}
                </a></th>

                <th><a href="?sort=customer__account_manager&direction={% if sort == 'customer__account_manager' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Hayley Account Manager {% if sort == 'customer__account_manager' %}{% if direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}
                </a></th>

                <th><a href="?sort=status&direction={% if sort == 'status' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                    Status {% if sort == 'status' %}{% if direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}
                </a></th>


                <th scope="col">Actions</th>

            </tr>
        </thead>
        <tbody>
            {% for problem in problems %}
            <tr>
            <td><a href="{% url 'customer' problem.customer.id %}">{{ problem.customer.name }}</a></td>
            <td>{{ problem.title }}</td>
            {% comment %} <td>{{ problem.impact }}</td> {% endcomment %}
            <td>{{ problem.urgency }}</td>
            <td>{{ problem.customer.account_manager }}</td>
            <td>{{ problem.status }}</td>
            <td><a href="{% url 'problem_edit' problem.id %}" class="btn btn-primary ">Edit</a>
            <a href="{% url 'problem_delete' problem.id %}" class="btn btn-danger ">Delete</a></td>

            </tr>
        {% endfor %}
        </tbody>
    </table>



{% endblock %}

