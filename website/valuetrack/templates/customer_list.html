{% extends 'base.html' %}


{% block content %}
customer_list.html

    <br/><br/>    
    <h1>Customer List</h1>
    <br/>


    <a href="{% url 'customer_add' %}" class="btn btn-success">Add Customer</a>
    <br/><br/>

    <div class="text-end mb-4">
        <h5>Customer Status Summary</h5>
        <ul class="list-inline">
            {% for item in customer_status_summary %}
            <li class="list-inline-item"><strong>{{ item.status }}:</strong> {{ item.count }}</li>
            {% endfor %}
        </ul>

        <h5>Problem Status Summary</h5>
        <ul class="list-inline">
            {% for item in problem_status_summary %}
            <li class="list-inline-item"><strong>{{ item.status }}:</strong> {{ item.count }}</li>
            {% endfor %}
        </ul>
    </div>


    <form method="get" class="mb-3 d-flex gap-3 align-items-end">
        <div>
            <label for="status">Filter by Customer Status:</label>
            <select name="status" id="status" class="form-select form-select-sm">
            <option value="">All</option>
            <option value="Active" {% if status_filter == 'Active' %}selected{% endif %}>Active</option>
            <option value="Inactive" {% if status_filter == 'Inactive' %}selected{% endif %}>Inactive</option>
            <option value="Pending" {% if status_filter == 'Pending' %}selected{% endif %}>Pending</option>
            </select>
        </div>

        <div>
            <button type="submit" class="btn btn-secondary btn-sm">Apply Filter</button>
            <a href="{% url 'customers' %}" class="btn btn-outline-secondary btn-sm">Reset</a>
        </div>

        <input type="hidden" name="sort" value="{{ sort }}">
        <input type="hidden" name="direction" value="{{ direction }}">
    </form>


    <table class="table table-striped table-hover table-bordered" >
        <thead class="table-light">
        <tr>
            <th><a href="?sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}">Name {% if sort == 'name' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th><a href="?sort=main_contact&direction={% if sort == 'main_contact' and direction == 'asc' %}desc{% else %}asc{% endif %}">Contact{% if sort == 'main_contact' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th>Phone</a></th>
            <th><a href="?sort=email&direction={% if sort == 'email' and direction == 'asc' %}desc{% else %}asc{% endif %}">Email{% if sort == 'email' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th><a href="?sort=account_manager&direction={% if sort == 'account_manager' and direction == 'asc' %}desc{% else %}asc{% endif %}">Haley Account Manager{% if sort == 'account_manager' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th><a href="?sort=status&direction={% if sort == 'status' and direction == 'asc' %}desc{% else %}asc{% endif %}">Status{% if sort == 'status' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th><a href="?sort=open_problems&direction={% if sort == 'open_problems' and direction == 'asc' %}desc{% else %}asc{% endif %}">Open{% if sort == 'open_problems' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
            <th><a href="?sort=closed_problems&direction={% if sort == 'closed_problems' and direction == 'asc' %}desc{% else %}asc{% endif %}">Closed{% if sort == 'closed_problems' %} {% if direction == 'asc' %} ↑ {% else %} ↓ {% endif %} {% endif %}</a></th>
        </tr>
        </thead>

        <tbody>
            {% for customer in customers %}
            <tr>
            <td><a href="{% url 'customer' customer.id %}">{{ customer.name }}</a></td>
            <td>{{ customer.main_contact }}</td>
            <td>{{ customer.phone }}</td>
            <td>{{ customer.email }}</td>
            <td>{{ customer.account_manager }}</td>
            <td>{{ customer.status }}</td>
            <td>{{ customer.open_problems }}</td>
            <td>{{ customer.closed_problems }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>



{% endblock %}

